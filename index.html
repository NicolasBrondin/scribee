<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <link rel="icon" href="img/icon.png"/>
    <style>
        body, html {
            background: #ecf0f1;
            font-family: Roboto,Helvetica,Arial;
            
            width:100vw;
            height:100vh;
            padding: 10px;
            overflow: hidden;
        }  
        
        @keyframes splash {
            0% {opacity: 1;visibility: visible;}
            50% {opacity: 1;visibility: visible;}
            99% {opacity: 0;visibility: visible;}
            100% {opacity: 0;visibility: hidden;}
            
        }
        
        #splash-screen{
            position: absolute;
            width:100vw;
            height:100vh;
            background: #ecf0f1;
            text-align: center;
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            overflow: hidden;
            animation-name: splash;
            animation-duration: 2s;
            animation-iteration-count: 1;
        }
        
        #splash-screen img {
            margin-top: calc((100vh - 500px)/2);
        }
    </style></head>
    <body onmousemove="Game.move_element(event)" onmouseup="Game.release_element(event)" ontouchmove="Game.move_element(event)" ontouchend="Game.release_element(event)">
        <div id="splash-screen">
            <img src="img/icon.png" width="500" height="500"/>
        </div>
        <div id="buttons_container" >
            <button onclick="Game.play_sound()">Ecouter la phrase</button>
        </div>
        <div id="elements_container" style="height:150px;">
            <div style="display:block;float:left; width:100px;margin:5px;" id="img1" onmousedown="Game.pick_element(event)" ontouchstart="Game.pick_element(event)" data="0">   
                <img style="width:100px; height:100px;" src="img/dog.png"/>
                <div style="position:relative;background: white;margin:0;padding:0;height:20px;text-align:center;font-weight:bold;">Chien</div> 
            </div>
            <div style="display:block;float:left;margin:5px;" id="img2" onmousedown="Game.pick_element(event)" ontouchstart="Game.pick_element(event)" data="1">   <img style="width:100px; height:100px;" src="img/forest.png"/> <div style="position:relative;background: white;margin:0;padding:0;height:20px;text-align:center;font-weight:bold;">Fôret</div> </div>
            <div style="display:block;float:left;margin:5px;" id="img3" onmousedown="Game.pick_element(event)" ontouchstart="Game.pick_element(event)" data="2">   <img style="width:100px; height:100px;" src="img/house.png"/> <div style="position:relative;background: white;margin:0;padding:0;height:20px;text-align:center;font-weight:bold;">Maison</div>  </div>
            <div style="display:block;float:left;margin:5px;" id="img4" onmousedown="Game.pick_element(event)" ontouchstart="Game.pick_element(event)" data="3">   <img style="width:100px; height:100px;" src="img/walk.png"/> <div style="position:relative;background: white;margin:0;padding:0;height:20px;text-align:center;font-weight:bold;">Marcher</div>  </div>
            <div style="display:block;float:left;margin:5px;" id="img5" onmousedown="Game.pick_element(event)" ontouchstart="Game.pick_element(event)" data="4">   <img style="width:100px; height:100px;" src="img/boy.png"/> <div style="position:relative;background: white;margin:0;padding:0;height:20px;text-align:center;font-weight:bold;">Garçon</div>  </div>
            </div>
        <div id="answers_container" style="height:150px;">
           
        <div  style=" width:100px; height:100px;float:left;line-height:100px; font-size: 20px;text-align:center;">Le</div>
        <div class="drop" id="div1" style="background: #bdc3c7; width:100px; height:100px;margin:5px;float:left;"></div>
            <div  style=" width:100px; height:100px;float:left;line-height:100px; font-size: 20px;text-align:center;">et son</div>
        <div class="drop" id="div2" style="background: #bdc3c7; width:100px; height:100px;margin:5px;float:left;"></div>
        <div class="drop" id="div3" style="background: #bdc3c7; width:100px; height:100px;margin:5px;float:left;"></div>
            <div  style=" width:100px; height:100px;float:left;line-height:100px; font-size: 20px;text-align:center;">vers la</div>
        <div class="drop" id="div4" style="background: #bdc3c7; width:100px; height:100px;margin:5px;float:left;"></div>
            <div  style=" width:100px; height:100px;float:left;line-height:100px; font-size: 20px;text-align:center;">dans la</div>
        <div class="drop" id="div5" style="background: #bdc3c7; width:100px; height:100px;margin:5px;float:left;"></div>
            </div>
        <div  id="buttons_container" style="height:150px;">
            <button onclick="Game.check_answers()">Continuer</button>
        </div>
        <script type="text/javascript">
            var JS = {
    mouse: {
        move: function(e){
            var x,y;

            
            if(e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel'){
            var touch = e.touches[0] || e.changedTouches[0];
            x = touch.pageX;
            y = touch.pageY;
          } else if (e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover'|| e.type=='mouseout' || e.type=='mouseenter' || e.type=='mouseleave') {
            x = e.pageX;
            y = e.pageY;
          }

             if (x < 0){x = 0;}
             if (y < 0){y = 0;}  
            return {x:x, y:y};
        }
    },
    element: {
        move: function(element, x,y){
             element.style.position = "absolute" ;
             element.style.left = x+"px";
             element.style.top = y+"px";
        },
        get_rect: function(element){
            return {x: element.offsetLeft, y: element.offsetTop, w: element.offsetWidth, h: element.offsetHeight};
        }
    }
    
};

var Game = {
     expected_answer: [4,0,3,2,1],
     given_answer:[],
     selected_element: null,
     sound: new Audio('audio/voice.mp3'),
     score: 0,
     elements: [],
     answers: [],
     play_sound: function() {
          if(Game.sound){
               Game.sound.play();
          }
     },
     pick_element: function(e){

         Game.selected_element = e.target.parentElement;
         Game.selected_element.style.border = "none";
         e.preventDefault();
     },
     release_element: function(e){
         if(Game.selected_element){
             //Need to check position
             //console.log(Game.answers);
             var position = Game.answers.find(function(a){
                 var rect1 = JS.element.get_rect(a);
                 var rect2 = JS.element.get_rect(Game.selected_element);
                 //console.log(rect1, rect2);
                 return rect2.x > rect1.x && rect2.x < (rect1.x + rect1.w) && rect2.y > rect1.y && rect2.y < (rect1.y + rect1.h);
             }.bind(this));
             //console.log(position);
             if(position /* && position.classList.indexOf('drop')!= -1*/){
                 if(position.children.length > 0){
                     Game.selected_element.parentElement.appendChild(position.children[0]);
                 }
                 JS.element.move(Game.selected_element,0,0);
                 Game.selected_element.style.position = 'relative';
                 position.appendChild(Game.selected_element);
               /* Game.selected_element.style.left = JS.element.get_rect(position).x; 
                Game.selected_element.style.top = JS.element.get_rect(position).y; */
                 //console.log(Game.selected_element);
             } else {
                 JS.element.move(Game.selected_element,0,0);
                 Game.selected_element.style.position = 'relative';
                 document.getElementById('elements_container').appendChild(Game.selected_element);
             }
             Game.given_answer = Game.answers.map(function(a){
                 
                 return a.children[0] ? parseInt(a.children[0].attributes.data.value) : null;
             });

         }
         Game.selected_element = null;
     }.bind(this),
     move_element: function(e){
          var position = JS.mouse.move(e);
          if(this.selected_element){
              JS.element.move(this.selected_element, position.x, position.y);
          }
     },
     check_answers: function(){
        console.log(Game.expected_answer);
         console.log(Game.given_answer);
          Game.expected_answer.forEach(function(a,i){
              console.log(Game.elements);
              if(Game.given_answer[i] && Game.given_answer[i]===a){
                  Game.elements[a].style.border = "none";
              }else {
                  Game.elements[a].style.border = "4px solid #e74c3c";
              }
          });
          if(JSON.stringify(Game.expected_answer) === JSON.stringify(Game.given_answer)){
              Game.score ++;
          } else {
              Game.score --;
          }
         console.log(Game.score);
     },
     init: function(){
         Game.elements = [].slice.call(document.getElementById('elements_container').children);
         Game.answers = [].slice.call(document.getElementById('answers_container').children).filter(function(i){console.log(i); return [].slice.call(i.classList).indexOf('drop') != -1;});
     }.bind(this),
     play: function(){
     }.bind(this)
};

Game.init();
        </script>
    </body>
</html>